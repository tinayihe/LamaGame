<!DOCTYPE html>
<html>
    <head>
        <title>Yipeng and Yihe lama</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width">
        <style type="text/css">
            * {
                margin: 0;
                padding: 0;
            }

            html, body {
                height: 100%;
                width: 100%;
            }

            canvas {
                display: block;
            }  
        </style>
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    </head>
    <body id="main">
        <canvas id="plane"></canvas>
        <script type="text/javascript">
            //document.getElementById('main').addEventListener('keypress', p);
            //function p(e) {alert(e.which)}
           
            var mode = Math.floor((Math.random() * 2) + 1);        
            var x = 0;
            var y = 0;
            var speed = 5;
            var random = Math.floor((Math.random() * 4) + 1);
            //random for image, 1:up 2:right 3:down 4:left
            var random_image = Math.floor((Math.random() * 4) + 1);
            var imageObj = new Image();
            
            //自动调节尺寸，感觉width好用但是height并没有什么卵用。。。
            var h = document.body.clientHeight;
            var w = document.body.clientWidth;
            var canvas = document.getElementById("plane");
            var score = 0;
            
            //remain the right part for score
            canvas.width = 0.9*w;
            canvas.height = h;

            function initial(){ // !!! no space between function name and the starting {
                // change dynamic canvas bg
                // !!! one space between if, else, for, while... and the starting (, then one space between ) and {
                if (mode === 1) {
                    //vert: selon movement direction
                    document.getElementById("plane").style.background = "#00FF7F";
                } else {
                    //rouge: selon image direction
                    document.getElementById("plane").style.background = "#FF2400";                ;
                }

                // change randomly lama image
                switch (random_image) {
                    case 1:
                        imageObj.src = "image/lama.jpg";
                        break;
                    case 2:
                        imageObj.src = "image/lama2.jpg";
                        break;
                    case 3:
                        imageObj.src = "image/lama3.jpg";
                        break;
                    case 4:
                        imageObj.src = "image/lama4.jpg";
                        break;
                }

                setInterval(animate(), 1000000);
            }

            function animate(){
                reqAnimFrame = window.mozRequestAnimationFrame ||
                        window.webkitRequestAnimationFrame ||
                        window.msRequestAnimationFrame ||
                        window.oRequestAnimationFrame
                        ;

                reqAnimFrame(animate);
                random = 2;
                switch (random) {
                    case 1:
                        // move up
                        y = (y - speed + 1000) % 1000;
                        break;
                    case 2:
                        // move right
                        x = (x + speed) % 1000;
                        break;
                    case 3:
                        // move down
                        y = (y + speed) % 1000;
                        break;
                    case 4:
                        // move left
                        x = (x - speed + 1000) % 1000;
                        break;
                }

                draw();
            }

            function draw(){
                var context = canvas.getContext("2d");
                context.clearRect(0, 0, 1500, 1500);
                context.drawImage(imageObj, x, y, 200, 200);
            }
            
            initial();
            
            function point(event){
                if (mode === 1) {
                    switch (event.keyCode) {
                    case 37:
                        if (random === 4){
                            score++;
                        }
                        break;
                    case 38:
                        if (random === 1){
                            score++;
                        }
                        break;
                    case 39:
                        if (random === 2){
                            score++;
                        }
                        break;
                    case 40:
                        if (random === 3){
                            score++;
                        }
                        break;
                    }
                }else {
                    switch (event.keyCode) {
                    case 37:
                        if (random_image === 4){
                            score++;
                        }
                        break;
                    case 38:
                        if (random_image === 1){
                            score++;
                        }
                        break;
                    case 39:
                        if (random_image === 2){
                            score++;
                        }
                        break;
                    case 40:
                        if (random_image === 3){
                            score++;
                        }
                        break;
                    }
                }
                alert(score);
            }
            
            document.addEventListener("keydown", point);            
        </script>
    </body>
</html>
